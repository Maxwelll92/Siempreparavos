<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#f3e5f5">
<title>Shaiel üå∏</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Quicksand:wght@400;600&family=Cormorant+Garamond:wght@500&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Quicksand', sans-serif;
    overflow-x: hidden;
    transition: background 2s ease, filter 2s ease;
    background: #f3e5f5;
}

.container {
    position: relative;
    z-index: 2;
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(20px);
    padding: 40px;
    border-radius: 35px;
    text-align: center;
    box-shadow: 0 20px 50px rgba(0,0,0,0.15);
    max-width: 520px;
    width: 90%;
    transition: all 1s ease;
}

h1 {
    font-family: 'Playfair Display', serif;
    font-size: 26px;
    margin-bottom: 8px;
}

#contador {
    font-family: 'Cormorant Garamond', serif;
    font-size: 15px;
    margin-bottom: 12px;
    opacity: 0.8;
}

#climaIcono {
    font-size: 55px;
    margin: 10px 0;
    transition: transform 1s ease;
}

#temperatura, #sensacion {
    font-size: 14px;
    margin-bottom: 3px;
}

canvas {
    margin-top: 10px;
}

.burbuja {
    margin-top: 18px;
    padding: 15px 20px;
    border-radius: 30px;
    font-family: 'Cormorant Garamond', serif;
    font-size: 18px;
    transition: all 0.4s ease;
}

#efectos {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
}

.estrella {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    animation: parpadear 2s infinite alternate;
}

@keyframes parpadear {
    from { opacity: 0.3; }
    to { opacity: 1; }
}
</style>
</head>

<body>

<div id="efectos"></div>

<div class="container">
    <h1>Shaiel üå∑</h1>
    <div id="contador"></div>
    <div id="ciudad"></div>
    <div id="climaIcono"></div>
    <div id="temperatura"></div>
    <div id="sensacion"></div>
    <canvas id="grafico" width="400" height="120"></canvas>
    <div id="mensaje" class="burbuja"></div>
</div>

<script>

/* ================= CONTADOR ================= */
const inicio = new Date("2026-01-30");
function actualizarContador() {
    const hoy = new Date();
    let a√±os = hoy.getFullYear() - inicio.getFullYear();
    let meses = hoy.getMonth() - inicio.getMonth();
    let dias = hoy.getDate() - inicio.getDate();
    if (dias < 0) {
        meses--;
        dias += new Date(hoy.getFullYear(), hoy.getMonth(), 0).getDate();
    }
    if (meses < 0) {
        a√±os--;
        meses += 12;
    }
    document.getElementById("contador").textContent =
        `${a√±os} a√±os ‚Ä¢ ${meses} meses ‚Ä¢ ${dias} d√≠as contigo`;
}
actualizarContador();

/* ================= CLIMA ================= */

let latGlobal, lonGlobal;
let intervaloClima;

function iniciarUbicacion() {
    navigator.geolocation.getCurrentPosition(pos => {
        latGlobal = pos.coords.latitude;
        lonGlobal = pos.coords.longitude;
        obtenerClima();
        iniciarAutoActualizacion();
    });
}

function obtenerClima() {

fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latGlobal}&longitude=${lonGlobal}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset&forecast_days=4&timezone=auto`)
.then(res => res.json())
.then(data => {

    const current = data.current_weather;
    const daily = data.daily;

    const temp = Math.round(current.temperature);
    const sensacion = Math.round(current.apparent_temperature ?? current.temperature);

    document.getElementById("temperatura").textContent = `Temperatura: ${temp}¬∞C`;
    document.getElementById("sensacion").textContent = `Sensaci√≥n t√©rmica: ${sensacion}¬∞C`;

    cambiarFondo(temp);

    animarIcono();

    dibujarGrafico(
        daily.temperature_2m_max.slice(1,4),
        daily.temperature_2m_min.slice(1,4)
    );

    detectarNoche(daily.sunrise[0], daily.sunset[0]);

    rotarMensajes(temp);

})
.catch(() => {
    document.getElementById("mensaje").textContent =
        "No pude actualizar el clima, pero sigo aqu√≠ üíó";
});
}

/* ================= FONDO DIN√ÅMICO ================= */

function cambiarFondo(temp) {
    if (temp >= 30)
        document.body.style.background = "linear-gradient(135deg,#ff9a9e,#fad0c4)";
    else if (temp >= 20)
        document.body.style.background = "linear-gradient(135deg,#ffe6f7,#fff1b8)";
    else if (temp >= 10)
        document.body.style.background = "linear-gradient(135deg,#d6e4ff,#e0c3fc)";
    else
        document.body.style.background = "linear-gradient(135deg,#cfd9df,#e2ebf0)";
}

/* ================= GR√ÅFICO ================= */

function dibujarGrafico(max, min) {
    const canvas = document.getElementById("grafico");
    const ctx = canvas.getContext("2d");

    ctx.clearRect(0,0,canvas.width,canvas.height);

    const temps = [...max, ...min];
    const tMax = Math.max(...temps);
    const tMin = Math.min(...temps);

    function escala(t) {
        return canvas.height - ((t - tMin) / (tMax - tMin)) * 80 - 20;
    }

    ctx.beginPath();
    ctx.moveTo(50, escala(max[0]));
    ctx.lineTo(150, escala(max[1]));
    ctx.lineTo(250, escala(max[2]));
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(50, escala(min[0]));
    ctx.lineTo(150, escala(min[1]));
    ctx.lineTo(250, escala(min[2]));
    ctx.stroke();
}

/* ================= NOCHE REAL ================= */

function detectarNoche(sunriseStr, sunsetStr) {
    const efectos = document.getElementById("efectos");
    efectos.innerHTML = "";

    const ahora = new Date();
    const sunrise = new Date(sunriseStr);
    const sunset = new Date(sunsetStr);

    if (ahora < sunrise || ahora > sunset) {
        for (let i = 0; i < 40; i++) {
            const star = document.createElement("div");
            star.className = "estrella";
            star.style.left = Math.random() * 100 + "vw";
            star.style.top = Math.random() * 100 + "vh";
            efectos.appendChild(star);
        }
        document.body.style.filter = "brightness(0.85)";
    } else {
        document.body.style.filter = "brightness(1)";
    }
}

/* ================= MENSAJES ================= */

function rotarMensajes(temp) {

    let mensajes;

    if (temp >= 25)
        mensajes = ["El calor es leve comparado contigo.", "Energ√≠a brillante.", "Luz constante."];
    else if (temp >= 15)
        mensajes = ["Clima suave.", "Todo fluye.", "Presencia tranquila."];
    else
        mensajes = ["Fr√≠o afuera.", "Calma interior.", "Cuidado constante."];

    const el = document.getElementById("mensaje");
    let i = 0;

    el.textContent = mensajes[0];

    setInterval(() => {
        el.style.opacity = 0;
        setTimeout(() => {
            i = (i + 1) % mensajes.length;
            el.textContent = mensajes[i];
            el.style.opacity = 1;
        }, 300);
    }, 30000);
}

/* ================= ICONO ANIMADO ================= */

function animarIcono() {
    const icono = document.getElementById("climaIcono");
    icono.textContent = "‚òÄÔ∏è";
    icono.style.transform = "rotate(360deg)";
}

/* ================= AUTO UPDATE ================= */

function iniciarAutoActualizacion() {
    intervaloClima = setInterval(obtenerClima, 1800000);
}

iniciarUbicacion();

</script>
</body>
    </html>
